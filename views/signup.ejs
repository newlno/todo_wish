<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <title>Document</title>
  </head>
  <body>
    <%- include("nav.html") %>
    <div class="jumbotron jumbotron-fluid">
      <div class="container">
        <h1 class="display-4">회원가입 페이지</h1>
        <p class="lead">
          This is a modified jumbotron that occupies the entire horizontal space
          of its parent.
        </p>
      </div>
    </div>
    <div class="container">
      <div class="form-group mb-4">
        <label>이메일</label>
        <input
          type="text"
          class="form-control email"
          name="email"
          id="email"
          placeholder="쓰고싶은 말"
        />
        <button type="button" class="btn btn-primary mt-2" id="mailCheck">
          인증받기
        </button>
      </div>

      <div class="form-group-id mb-4">
        <label>아이디</label>
        <input
          type="text"
          class="form-control userId"
          name="id"
          id="userId"
          placeholder="영소문자,숫자로 구성된 4~20글자로 작성해주세요."
        />
        <button type="button" class="btn btn-primary mt-2" id="idCheck">
          중복확인
        </button>
      </div>

      <div class="form-group mb-3">
        <label>비밀번호</label>
        <input
          type="text"
          class="form-control pw"
          name="pw"
          id="pw"
          placeholder="쓰고싶은 말"
        />
        <!-- <input type="password" class="form-control" name="pw" /> -->
      </div>
      <button type="button" class="btn btn-danger" id="signUp">가입하기</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <script>
      var idval;
      var pwval;
      var emailval;
      $("#idCheck").click(function () {
        idval = $(".userId").val();
        console.log("버튼이벤트", idval);
        const idvalcheck = /^[a-z0-9]+$/;
        if (idval == "") {
          alert("아이디를 입력해주세요.");
          return false;
        } else if (
          !idvalcheck.test(idval) ||
          idval.length < 4 ||
          idval.length > 20
        ) {
          alert("아이디는 영소문자,숫자로 구성된 4~20글자로 작성해주세요.");
          $("#userid").focus();
          return false;
        }
        console.log(idval);
        $.ajax({
          method: "post",
          url: "/signup/check/id",
          data: { userId: idval },
        }).done((result) => {
          console.log("에이젝스 결과", result);
          if (result == "404") {
            alert("정상적인 접근이 아닙니다.");
          } else if (result) {
            alert("사용 가능한 아이디 입니다.");
            $("#idCheck").prop("disabled", true);
            $("#userId").prop("readonly", true);
          } else {
            alert("이미 사용중인 아이디 입니다.");
          }
        });
      });

      $("#signUp").click(function () {
        const checkPw =
          /^.*(?=^.{6,20}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&+=]).*$/;
        idval = $(".userId").val();
        pwval = $(".pw").val();
        emailval = $(".email").val();
        console.log(emailval);
        if (!checkPw.test(pwval)) {
          alert(
            "비밀번호는 영문대소문자,숫자,특수문자로 구성된 6~20글자로 작성해주세요."
          );
        } else {
          $.ajax({
            method: "post",
            url: "/signup",
            data: { userId: idval, email: emailval, pw: pwval },
          })
            .done((result) => {
              if (result == "404") {
                alert("정상적인 접근이 아닙니다.");
                window.location.reload();
              }
              console.log("ajax 성공");
            })
            .fail((fail) => {
              console.log("ajax 실패");
            });
        }
      });

      //  $("#search").click(() => {
      //   var inputData = $("#searchInput").val();
      //   window.location.replace("/search?value=" + inputData);
      // });
    </script>
  </body>
</html>
